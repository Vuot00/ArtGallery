<div class="profilo-container">

    <div class="header-card">
        <div class="avatar-big">
            {{ utente.nome ? utente.nome.charAt(0).toUpperCase() : 'U' }}
        </div>
        <div class="info">
            <h1>{{ utente.nome }}</h1>
            <p>{{ utente.email }}</p>
            <span *ngIf="authService.isArtist()" class="badge-artista">ğŸ¨ Artista Verificato</span>
        </div>
    </div>

    <div class="tabs-nav">
        <button [class.active]="activeTab === 'dati'" (click)="activeTab = 'dati'">âœï¸ Dati</button>

        <ng-container *ngIf="authService.isArtist()">
            <button [class.active]="activeTab === 'opere'" (click)="activeTab = 'opere'">ğŸ–¼ï¸ Le mie Opere</button>
            <button [class.active]="activeTab === 'vendite'" (click)="activeTab = 'vendite'">ğŸ’° Vendite</button>
        </ng-container>

        <button [class.active]="activeTab === 'acquisti'" (click)="activeTab = 'acquisti'">ğŸ›ï¸ Acquisti</button>
        <button [class.active]="activeTab === 'sicurezza'" (click)="activeTab = 'sicurezza'">ğŸ”’ Sicurezza</button>
    </div>

    <div class="tab-content" *ngIf="activeTab === 'dati'">
        <h3>I miei Dati</h3>
        <form (ngSubmit)="salvaDati()" class="form-profilo">
            <div class="form-group">
                <label>Nome Completo</label>
                <input type="text" [(ngModel)]="utente.nome" name="nome">
            </div>
            <div class="form-group">
                <label>Email (Non modificabile)</label>
                <input type="text" [value]="utente.email" disabled class="disabled">
            </div>
            <button type="submit" class="btn-save">Salva Modifiche</button>
        </form>
    </div>

    <div class="tab-content" *ngIf="activeTab === 'opere'">
        <h3>Opere Caricate</h3>

        <div *ngIf="mieOpere.length === 0" class="empty-state">
            <p>Non hai ancora caricato nessuna opera.</p>
            <a routerLink="/carica-opera">Carica la prima!</a>
        </div>

        <div class="mini-grid">
            <div class="mini-card" *ngFor="let opera of mieOpere">

                <img [src]="opera.immagini && opera.immagini.length > 0
                    ? 'http://localhost:8080/uploads/' + opera.immagini[0].url
                    : 'assets/placeholder.png'"
                     alt="{{ opera.titolo }}"
                     style="width: 100%; height: 180px; object-fit: cover;">

                <div class="mini-info">

                    <strong>{{ opera.titolo }}</strong>

                    <span>â‚¬ {{ opera.prezzo }}</span>

                    <div class="card-actions">

                        <!-- SEZIONE ASTA IN CORSO -->
                        <div *ngIf="opera.stato === 'IN_ASTA'" class="badge-asta">
                            â³ In Asta
                        </div>

                        <!-- SEZIONE PROGRAMMATA (AGGIORNATA) -->
                        <div *ngIf="opera.stato === 'PROGRAMMATA'" style="text-align: center; width: 100%;">

                            <!-- Badge Giallo con Data e Ora -->
                            <div class="badge-asta" style="background-color: #fff3cd; color: #856404; border-color: #ffeeba; display: flex; align-items: center; justify-content: center; font-weight: bold; gap: 5px;">
                                ğŸ“… {{ opera.asta?.dataInizio | date:'dd/MM HH:mm' }}
                            </div>

                            <!-- Bottone Annulla -->
                            <button class="btn-delete-opera"
                                    style="width: 100%; background-color: #dc3545; color: white; margin-top: 5px;"
                                    (click)="annullaProgrammazione(opera)"
                                    title="Annulla Programmazione">
                                âŒ Annulla
                            </button>
                        </div>

                        <!-- SEZIONE VENDUTA -->
                        <div *ngIf="opera.stato === 'VENDUTA'" class="badge-asta" style="background-color: #d4edda; color: #155724; border-color: #c3e6cb;">
                            âœ… Venduta
                        </div>

                        <!-- SEZIONE DISPONIBILE -->
                        <ng-container *ngIf="opera.stato === 'DISPONIBILE'">

                            <button class="btn-auction" (click)="openAstaModal(opera.id)" title="Metti all'Asta">
                                ğŸ”¨
                            </button>

                            <button class="btn-edit" [routerLink]="['/modifica-opera', opera.id]" title="Modifica">
                                âœï¸
                            </button>

                            <button class="btn-delete-opera" (click)="eliminaOpera(opera.id)" title="Elimina Opera">
                                ğŸ—‘ï¸
                            </button>

                        </ng-container>

                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="tab-content" *ngIf="activeTab === 'vendite'">
        <h3>Storico Vendite</h3>
        <div class="todo-box">
            ğŸš§ <strong>FunzionalitÃ  in arrivo!</strong><br>
            Qui vedrai lo storico delle opere che hai venduto e i guadagni totali.
        </div>
    </div>

    <div class="tab-content" *ngIf="activeTab === 'acquisti'">
        <h3>I miei Acquisti</h3>
        <div class="todo-box">
            ğŸš§ <strong>FunzionalitÃ  in arrivo!</strong><br>
            Qui vedrai le opere che hai acquistato.
        </div>
    </div>

    <div class="tab-content" *ngIf="activeTab === 'sicurezza'">
        <h3>Cambia Password</h3>
        <form (ngSubmit)="cambiaPassword()" class="form-profilo">
            <div class="form-group">
                <label>Vecchia Password</label>
                <input type="password" [(ngModel)]="passData.vecchiaPassword" name="old" required>
            </div>
            <div class="form-group">
                <label>Nuova Password</label>
                <input type="password" [(ngModel)]="passData.nuovaPassword" name="new" required>
            </div>
            <div class="form-group">
                <label>Conferma Nuova</label>
                <input type="password" [(ngModel)]="passData.confermaPassword" name="confirm" required>
            </div>
            <button type="submit" class="btn-danger">Aggiorna Password</button>
        </form>
    </div>

</div>

<app-avvia-asta
        *ngIf="showAstaModal && selectedOperaId"
        [operaId]="selectedOperaId"
        (close)="closeModal()"
        (auctionStarted)="refreshList()">
</app-avvia-asta>