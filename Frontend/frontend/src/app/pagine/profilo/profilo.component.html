<div class="profilo-container">

  <div class="header-card">
    <div class="avatar-big">
      {{ utente.nome ? utente.nome.charAt(0).toUpperCase() : 'U' }}
    </div>
    <div class="info">
      <h1>{{ utente.nome }}</h1>
      <p>{{ utente.email }}</p>
      <span *ngIf="authService.isArtist()" class="badge-artista">ğŸ¨ Artista Verificato</span>
    </div>
  </div>

  <div class="tabs-nav">
    <button [class.active]="activeTab === 'dati'" (click)="activeTab = 'dati'">
      âœï¸ Dati
    </button>

    <ng-container *ngIf="authService.isArtist()">
      <button [class.active]="activeTab === 'opere'" (click)="activeTab = 'opere'">
        ğŸ–¼ï¸ Le mie Opere
      </button>
      <button [class.active]="activeTab === 'vendite'" (click)="activeTab = 'vendite'">
        ğŸ’° Vendite
      </button>
    </ng-container>

    <button [class.active]="activeTab === 'acquisti'" (click)="activeTab = 'acquisti'">
      ğŸ›ï¸ Acquisti
    </button>
    <button [class.active]="activeTab === 'sicurezza'" (click)="activeTab = 'sicurezza'">
      ğŸ”’ Sicurezza
    </button>
  </div>

  <div class="tab-content" *ngIf="activeTab === 'dati'">
    <h3>I miei Dati</h3>
    <form (ngSubmit)="salvaDati()" class="form-profilo">
      <div class="form-group">
        <label>Nome Completo</label>
        <input type="text" [(ngModel)]="utente.nome" name="nome">
      </div>
      <div class="form-group">
        <label>Email (Non modificabile)</label>
        <input type="text" [value]="utente.email" disabled class="disabled">
      </div>
      <button type="submit" class="btn-save">Salva Modifiche</button>
    </form>
  </div>

  <div class="tab-content" *ngIf="activeTab === 'opere'">
    <h3>Opere Caricate</h3>

    <div *ngIf="mieOpere.length === 0" class="empty-state">
      <p>Non hai ancora caricato nessuna opera.</p>
      <a routerLink="/carica-opera">Carica la prima!</a>
    </div>

    <div class="mini-grid">
      <div class="mini-card" *ngFor="let opera of mieOpere">

        <img [src]="'http://localhost:8080/uploads/' + (opera.immagini && opera.immagini[0]?.url)"
             alt="{{ opera.titolo }}"
             style="width: 100%; height: 180px; object-fit: cover;">

        <div class="mini-info">
          <strong>{{ opera.titolo }}</strong>
          <span>â‚¬ {{ opera.prezzo }}</span>

          <div class="card-actions" style="margin-top: auto; display: flex; gap: 10px;">
            <button class="btn-edit" [routerLink]="['/modifica-opera', opera.id]" style="flex: 1;">
              âœï¸ Modifica
            </button>

            <button class="btn-delete-opera" (click)="eliminaOpera(opera.id)" title="Elimina Opera">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-content" *ngIf="activeTab === 'vendite'">
    <h3>Storico Vendite</h3>

    <div *ngIf="vendite.length === 0" class="empty-state">
      <p>Non hai ancora venduto nessuna opera. Continua a creare!</p>
    </div>

    <div class="mini-grid">
      <div class="mini-card" *ngFor="let opera of vendite">

        <img
          [src]="'http://localhost:8080/uploads/' + (opera.immagini && opera.immagini[0]?.url)"
          alt="{{ opera.titolo }}"
          style="width: 100%; height: 180px; object-fit: cover;">

        <div class="mini-info">
          <strong>{{ opera.titolo }}</strong>

          <span style="color: #2e7d32; font-weight: bold; font-size: 1.1rem;">
            + â‚¬ {{ opera.prezzo }}
          </span>

          <div class="card-actions" style="margin-top: auto; text-align: center;">
             <span class="badge-venduto">
               ğŸ’° VENDUTA
             </span>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div class="tab-content" *ngIf="activeTab === 'acquisti'">
    <h3>I miei Acquisti</h3>

    <div *ngIf="acquisti.length === 0" class="empty-state">
      <p>Non hai ancora acquistato nessuna opera.</p>
      <a routerLink="/home">Esplora la Vetrina</a>
    </div>

    <div class="mini-grid">
      <div class="mini-card" *ngFor="let ordine of acquisti">

        <img [src]="'http://localhost:8080/uploads/' + (ordine.opera?.immagini && ordine.opera?.immagini[0]?.url)"
             alt="{{ ordine.opera?.titolo }}"
             style="width: 100%; height: 180px; object-fit: cover;">

        <div class="mini-info">
          <strong>{{ ordine.opera?.titolo }}</strong>
          <span style="color: #333;">Pagato: â‚¬ {{ ordine.importo }}</span>

          <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">
            Data: {{ ordine.dataCreazione | date:'dd/MM/yyyy' }}
          </div>

          <div class="card-actions" style="margin-top: auto;">
             <span class="badge-pagato">
               ğŸ“¦ ORDINE #{{ ordine.id }}
             </span>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div class="tab-content" *ngIf="activeTab === 'sicurezza'">
    <h3>Cambia Password</h3>
    <form (ngSubmit)="cambiaPassword()" class="form-profilo">
      <div class="form-group">
        <label>Vecchia Password</label>
        <input type="password" [(ngModel)]="passData.vecchiaPassword" name="old" required>
      </div>
      <div class="form-group">
        <label>Nuova Password</label>
        <input type="password" [(ngModel)]="passData.nuovaPassword" name="new" required>
      </div>
      <div class="form-group">
        <label>Conferma Nuova</label>
        <input type="password" [(ngModel)]="passData.confermaPassword" name="confirm" required>
      </div>
      <button type="submit" class="btn-danger">Aggiorna Password</button>
    </form>
  </div>

</div>
